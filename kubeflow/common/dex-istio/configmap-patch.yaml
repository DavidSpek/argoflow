apiVersion: v1
kind: ConfigMap
metadata:
  name: dex
data:
  config.yaml: |
    issuer: https://kubeflow.abs-cloud.nl/dex
    storage:
      type: kubernetes
      config:
        inCluster: true
    web:
      http: 0.0.0.0:5556
    logger:
      level: "debug"
      format: text
    oauth2:
      skipApprovalScreen: true
    enablePasswordDB: true
    staticPasswords:
    - email: user@kubeflow.org
      hash: $2y$12$4K/VkmDd1q1Orb3xAt82zu8gk7Ad6ReFR4LCP9UeYE90NLiN9Df72
      # https://github.com/dexidp/dex/pull/1601/commits
      # FIXME: Use hashFromEnv instead
      username: user
      userID: "15841185641784"
    staticClients:
    # https://github.com/dexidp/dex/pull/1664
    - idEnv: OIDC_CLIENT_ID
      redirectURIs: ["/login/oidc"]
      name: 'Dex Login Application'
      secretEnv: OIDC_CLIENT_SECRET
    connectors:
    - type: gitlab
      # Required field for connector id.
      id: gitlab
      # Required field for connector name.
      name: GitLab
      config:
        # optional, default = https://gitlab.com
        baseURL: https://gitlab.abs-cloud.nl
        # Credentials can be string literals or pulled from the environment.
        clientID: 8756914099aa66872fae3186e22c2504dff393666e74a853890f5a9d346fdda4
        clientSecret: cc965e446a25e7f6382624716881771db677d38e6828f793b0bb86bef72e7fca
        redirectURI: https://kubeflow.abs-cloud.nl/dex/callback
        # Optional groups whitelist, communicated through the "groups" scope.
        # If `groups` is omitted, all of the user's GitLab groups are returned when the groups scope is present.
        # If `groups` is provided, this acts as a whitelist - only the user's GitLab groups that are in the configured `groups` below will go into the groups claim.  Conver>
        # groups:
        # - my-group
        # flag which will switch from using the internal GitLab id to the users handle (@mention) as the user id.
        # It is possible for a user to change their own user name but it is very rare for them to do so
        useLoginAsID: false
